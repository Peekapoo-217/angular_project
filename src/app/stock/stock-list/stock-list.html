<div class="stock-container">
  <div *ngIf="error" class="info">{{ error }}</div>

  <div class="create-stock">
    <h2>Quản lý cổ phiếu</h2>
    <button (click)="showCreateForm = !showCreateForm" class="add-stock-btn">
      {{ showCreateForm ? 'Đóng' : 'Thêm cổ phiếu mới' }}
    </button>

    <app-stock-create *ngIf="showCreateForm" (stockAdded)="onStockAdded($event)" (cancel)="showCreateForm = false">
    </app-stock-create>

  </div>

  <div class="view-controls" *ngIf="stocks.length > 0">
    <h3>Danh sách cổ phiếu</h3>
    <div class="view-toggle">
      <button [class.active]="showTableView" (click)="showTableView = true" class="toggle-option">
        <span>Table</span>
      </button>
      <button [class.active]="!showTableView" (click)="showTableView = false" class="toggle-option">
        <span>Card</span>
      </button>
    </div>
  </div>

  <div class="search-bar" *ngIf="stocks.length > 0">
    <input type="text" placeholder="Tìm kiếm theo tên hoặc mã..." [(ngModel)]="searchTerm" />
    <button (click)="onSearch()">Tìm</button>
  </div>


  <div class="stock-table" *ngIf="stocks.length > 0 && showTableView">
    <table>
      <thead>
        <tr>
          <th>Mã</th>
          <th>Tên</th>
          <th>Giá hiện tại</th>
          <th>Giá trước đó</th>
          <th>Thay đổi</th>
          <th>Sàn</th>
          <th>Yêu thích</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let stock of filteredStocks" [class.positive]="stock.isPositiveChange()"
          [class.negative]="!stock.isPositiveChange()">
          <td>{{ stock.code }}</td>
          <td>{{ stock.name }}</td>
          <td>{{ stock.price | number:'1.2-2' }}</td>
          <td>{{ stock.previousPrice | number:'1.2-2' }}</td>
          <td [class.positive]="stock.isPositiveChange()" [class.negative]="!stock.isPositiveChange()">
            {{ (stock.price - stock.previousPrice) | number:'1.2-2' }} ({{ ((stock.price - stock.previousPrice) /
            stock.previousPrice * 100) | number:'1.2-2' }}%)
          </td>
          <td>{{ stock.exchange }}</td>
          <td>
            <button (click)="stock.favorite = !stock.favorite" [class.favorite]="stock.favorite" class="favorite-btn">
              {{ stock.favorite ? '★' : '☆' }}
            </button>
          </td>
          <td class="actions">
            <button class="view" (click)="onView(stock)">Xem</button>
            <button class="edit" (click)="onEdit(stock)">Cập nhật</button>
            <button class="delete" (click)="onDelete(stock)">Xóa</button>
          </td>

        </tr>
      </tbody>
    </table>
  </div>


  <div class="stock-items" *ngIf="!showTableView">
    <div *ngFor="let stock of stocks">
      <app-stock-item [stock]="stock" [favorite]="stock.favorite"></app-stock-item>
    </div>
  </div>

  <div class="no-stocks" *ngIf="stocks.length === 0">
    <p>Chưa có cổ phiếu nào. Hãy thêm cổ phiếu mới!</p>
  </div>



  <!-- Dialog Xem chi tiết -->
  <div class="dialog-backdrop" *ngIf="showViewDialog">
    <div class="dialog">
      <h3>Chi tiết cổ phiếu</h3>
      <p><strong>Mã:</strong> {{ selectedStock?.code }}</p>
      <p><strong>Tên:</strong> {{ selectedStock?.name }}</p>
      <p><strong>Giá hiện tại:</strong> {{ selectedStock?.price | number:'1.2-2' }}</p>
      <p><strong>Giá trước đó:</strong> {{ selectedStock?.previousPrice | number:'1.2-2' }}</p>
      <p><strong>Sàn:</strong> {{ selectedStock?.exchange }}</p>
      <button (click)="closeViewDialog()">Đóng</button>
    </div>
  </div>

  <!-- Dialog Cập nhật -->
  <div class="dialog-backdrop" *ngIf="showEditDialog">
    <div class="dialog">
      <h3>Cập nhật cổ phiếu</h3>
      <label>
        Tên:
        <input [(ngModel)]="selectedStock!.name" />
      </label>
      <label>
        Giá hiện tại:
        <input type="number" [(ngModel)]="selectedStock!.price" />
      </label>
      <label>
        Giá trước đó:
        <input type="number" [(ngModel)]="selectedStock!.previousPrice" />
      </label>
      <label>
        Sàn:
        <input [(ngModel)]="selectedStock!.exchange" />
      </label>
      <div class="dialog-actions">
        <button (click)="saveEdit()">Lưu</button>
        <button (click)="showEditDialog=false; selectedStock=null">Hủy</button>
      </div>
    </div>
  </div>


</div>